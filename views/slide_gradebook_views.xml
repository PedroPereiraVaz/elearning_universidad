<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- VISTA FORMULARIO: DETALLE DE EVALUACIÓN INDIVIDUAL -->
    <record id="view_slide_slide_partner_form_university" model="ir.ui.view">
        <field name="name">slide.slide.partner.form.university</field>
        <field name="model">slide.slide.partner</field>
        <field name="arch" type="xml">
            <form string="Calificación de Contenido">
                <header>
                    <button name="accion_confirmar_nota" string="Confirmar Nota" type="object" 
                            class="btn-primary" invisible="estado_evaluacion == 'evaluado'"/>
                    <field name="estado_evaluacion" widget="statusbar"/>
                </header>
                <sheet>
                    <group>
                        <group string="Información del Alumno">
                            <field name="partner_id" readonly="1"/>
                            <field name="channel_id" readonly="1"/>
                            <field name="slide_id" readonly="1"/>
                        </group>
                        <group string="Evaluación">
                            <field name="nota_evaluacion" widget="float"/>
                            <field name="fecha_entrega" readonly="1"/>
                            <field name="archivo_entrega" filename="nombre_archivo" widget="binary"/>
                            <field name="nombre_archivo" invisible="1"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- VISTA LISTA: PENDIENTES DE EVALUAR -->
    <record id="view_slide_slide_partner_tree_pending" model="ir.ui.view">
        <field name="name">slide.slide.partner.tree.pending</field>
        <field name="model">slide.slide.partner</field>
        <field name="arch" type="xml">
            <list string="Pendientes de Evaluar" create="0" edit="0" decoration-warning="estado_evaluacion == 'pendiente_revision'">
                <field name="partner_id"/>
                <field name="channel_id"/>
                <field name="slide_id"/>
                <field name="fecha_entrega"/>
                <field name="archivo_entrega" widget="binary" filename="nombre_archivo" string="Entrega"/>
                <field name="estado_evaluacion" widget="badge" decoration-warning="estado_evaluacion == 'pendiente_revision'"/>
                <button name="accion_confirmar_nota" string="Cerrar Nota" type="object" icon="fa-check" title="Confirmar esta nota"/>
            </list>
        </field>
    </record>

    <!-- VISTA LISTA: BOLETÍN DE NOTAS (INSCRIPCIONES) -->
    <record id="view_slide_channel_partner_tree_gradebook" model="ir.ui.view">
        <field name="name">slide.channel.partner.tree.gradebook</field>
        <field name="model">slide.channel.partner</field>
        <field name="arch" type="xml">
            <list string="Boletín de Notas" create="0" delete="0">
                <field name="master_id" invisible="1"/>
                <field name="partner_id"/>
                <field name="channel_id"/>
                <field name="nota_final" widget="progressbar" string="Calificación Final" avg="Promedio"/>
                <field name="estado_nota" widget="badge" 
                       decoration-info="estado_nota == 'pendiente_presentar'" 
                       decoration-warning="estado_nota == 'pendiente_revision'" 
                       decoration-success="estado_nota in ['evaluado', 'certificado']"/>
            </list>
        </field>
    </record>

    <!-- VISTA FORMULARIO: ACTA ACADÉMICA -->
    <record id="view_slide_channel_partner_form_gradebook" model="ir.ui.view">
        <field name="name">slide.channel.partner.form.gradebook</field>
        <field name="model">slide.channel.partner</field>
        <field name="arch" type="xml">
            <form string="Acta Académica" create="0">
                <header>
                    <button name="accion_cerrar_acta" string="Cerrar Acta" type="object" class="btn-primary"
                            invisible="estado_nota not in ['pendiente_presentar', 'pendiente_revision']"/>
                    <button name="action_issue_university_degree" string="Emitir Título" type="object" class="btn-success"
                            invisible="estado_nota != 'evaluado' or not titulo_emitido == False"/>
                    <field name="estado_nota" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="partner_id" readonly="1"/>
                        </h1>
                        <h3>
                            <field name="channel_id" readonly="1"/>
                            <field name="master_id" invisible="1"/>
                        </h3>
                    </div>
                    <group>
                        <group string="Resumen Académico">
                            <field name="nota_final" widget="float"/>
                            <field name="nota_manual" widget="boolean_toggle"/>
                        </group>
                        <group string="Certificación" invisible="not titulo_emitido">
                            <field name="titulo_emitido"/>
                            <field name="fecha_emision_titulo"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="asignaturas" string="Asignaturas del Master" invisible="not asignatura_partner_ids">
                             <field name="asignatura_partner_ids" readonly="1">
                                <list string="Asignaturas" decoration-success="estado_nota in ['evaluado', 'certificado']">
                                    <field name="channel_id"/>
                                    <field name="nota_final" widget="progressbar"/>
                                    <field name="estado_nota" widget="badge"/>
                                    <button name="action_open_gradebook_form" string="Ir a Calificar" type="object" icon="fa-external-link"/>
                                </list>
                             </field>
                        </page>
                        <page name="evaluaciones" string="Desglose de Calificaciones">
                            <field name="evaluaciones_ids">
                                <list editable="bottom" create="0">
                                    <field name="slide_id" readonly="1"/>
                                    <field name="fecha_entrega" readonly="1"/>
                                    <field name="nota_evaluacion"/>
                                    <field name="estado_evaluacion" widget="badge"/>
                                    <button name="accion_confirmar_nota" string="Cerrar" type="object" icon="fa-check" 
                                            invisible="estado_evaluacion == 'evaluado'"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- ACCIÓN: PENDIENTES DE EVALUAR -->
    <record id="action_universidad_pendientes" model="ir.actions.act_window">
        <field name="name">Pendientes de Evaluar</field>
        <field name="res_model">slide.slide.partner</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('estado_evaluacion', '=', 'pendiente_revision')]</field>
        <field name="view_id" ref="view_slide_slide_partner_tree_pending"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                ¡Todo al día!
            </p>
            <p>
                No hay entregas pendientes de revisión en tus cursos.
            </p>
        </field>
    </record>

    <!-- ACCIÓN: BOLETÍN DE NOTAS -->
    <record id="action_universidad_boletin" model="ir.actions.act_window">
        <field name="name">Boletín de Notas</field>
        <field name="res_model">slide.channel.partner</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="view_slide_channel_partner_tree_gradebook"/>
        <field name="context">{'group_by': 'master_id'}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No hay inscripciones para mostrar.
            </p>
        </field>
    </record>
    
</odoo>
